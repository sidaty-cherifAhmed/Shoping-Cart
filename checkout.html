<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Checkout â€“ IndexedDB Basket</title>

    <style>
    

      * {
        box-sizing: border-box; 
      }

      body {
        margin: 0;
        min-height: 100vh;

        display: flex;
        justify-content: center;
        align-items: center;

        background: radial-gradient(circle at top, #111827, #020617 60%);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: #f9fafb;
      }

      /* âœ… main checkout container */
      .checkout-shell {
        width: 900px;
        max-width: 95vw;
        background: #020617;
        border-radius: 20px;
        box-shadow: 0 24px 60px rgba(0, 0, 0, 0.85);
        border: 1px solid rgba(148, 163, 184, 0.4);
        padding: 24px 26px 28px;

        display: flex;
        flex-direction: column;
        gap: 16px;
      }

      .checkout-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
      }

      .checkout-header h1 {
        margin: 0;
        font-size: 1.8rem;
      }

      .checkout-header p {
        margin: 4px 0 0;
        color: #9ca3af;
      }

      button {
        padding: 8px 14px;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-size: 0.85rem;
        font-weight: 600;
        color: #e5e7eb;
        background: #2563eb;
        transition: 0.18s;
        box-shadow: 0 3px 10px rgba(37, 99, 235, 0.45);
      }

      button:hover {
        background: #1d4ed8;
        transform: translateY(-1px);
      }

      .btn-secondary {
        background: #6b7280;
      }

      .btn-secondary:hover {
        background: #4b5563;
      }

      .btn-danger {
        background: #dc2626;
      }

      .btn-danger:hover {
        background: #b91c1c;
      }

      .table-box {
        background: #030712;
        border-radius: 16px;
        padding: 14px 16px;
        border: 1px solid rgba(55, 65, 81, 0.9);
      }

      .section-title {
        font-size: 0.95rem;
        font-weight: 600;
        margin-bottom: 8px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        background: #020617;
        border-radius: 10px;
        overflow: hidden;
      }

      th,
      td {
        padding: 7px 9px;
        border-bottom: 1px solid rgba(31, 41, 55, 0.9);
      }

      th {
        background: #0f172a;
        font-weight: 600;
      }

      tbody tr:nth-child(even) {
        background: #020617;
      }
      tbody tr:nth-child(odd) {
        background: #030712;
      }

      .empty {
        font-size: 0.85rem;
        color: #9ca3af;
        margin-top: 6px;
      }

      .summary-row {
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
        font-size: 1rem;
      }

      .total-value {
        font-weight: 700;
        color: #4ade80;
      }

      .status-bar {
        font-size: 0.8rem;
        color: #9ca3af;
        display: flex;
        justify-content: space-between;
        margin-top: 10px;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        margin-right: 6px;
      }

      .dot-ok {
        background: #22c55e;
      }
      .dot-wait {
        background: #facc15; 
      }

      .status-row {
        display: flex;
        align-items: center;
      }
    </style>
  </head>

  <body>
    <div class="checkout-shell">
   
      <div class="checkout-header">
        <div>
          <h1>Checkout</h1>
          <p>Review your basket items stored in IndexedDB</p>
        </div>

        <button class="btn-secondary" onclick="goBack()">â¬… Back to Shop</button>
      </div>

    
      <div class="table-box">
        <div class="section-title">ðŸ§º Basket Summary</div>

        <table>
          <thead>
            <tr>
              <th>Product</th>
              <th style="width: 80px">Qty</th>
              <th style="width: 90px">Price</th>
              <th style="width: 100px">Total</th>
            </tr>
          </thead>

         
          <tbody id="basketBody"></tbody>
        </table>

   
        <div id="emptyMsg" class="empty">Loading basket...</div>

      
        <div class="summary-row">
          <span>Total Amount:</span>
          <span id="totalAmount" class="total-value">$0.00</span>
        </div>

        <div style="margin-top: 12px; display: flex; gap: 8px">
          <button class="btn-danger" onclick="clearBasket()">
            ðŸ—‘ Clear Basket
          </button>
          <button onclick="confirmOrder()">âœ… Confirm Order</button>
        </div>
      </div>

      <div class="status-bar">
        <div class="status-row">
          <span id="statusDot" class="status-dot dot-wait"></span>
          <span id="statusText">Opening database...</span>
        </div>
        <span>Basket stored in IndexedDB â†’ cart</span>
      </div>
    </div>

    <script>


      
      let db = null;

      const basketBody = document.getElementById("basketBody");
      const emptyMsg = document.getElementById("emptyMsg");
      const totalAmount = document.getElementById("totalAmount");
      const statusDot = document.getElementById("statusDot");
      const statusText = document.getElementById("statusText");

     

      function setStatusOk(msg) {
        statusDot.classList.remove("dot-wait");
        statusDot.classList.add("dot-ok");
        statusText.textContent = msg;
      }

      function setStatusWait(msg) {
        statusDot.classList.remove("dot-ok");
        statusDot.classList.add("dot-wait");
        statusText.textContent = msg;
      }


      setStatusWait("Opening database...");

      const request = indexedDB.open("ShopDB", 1);

      request.onsuccess = function (e) {
        db = e.target.result; // save db reference
        setStatusOk("Database opened.");
        loadCart(); // now we can read cart items
      };

      request.onerror = function () {
        setStatusWait("Error opening DB.");
        console.error("DB error");
      };



      function loadCart() {
        basketBody.innerHTML = "";
        emptyMsg.textContent = "Loading basket...";

        const tx = db.transaction("cart", "readonly");
        const store = tx.objectStore("cart");

        const req = store.getAll();

        req.onsuccess = function () {
          const items = req.result;

          if (!items || items.length === 0) {
            emptyMsg.textContent = "Basket is empty.";
            totalAmount.textContent = "$0.00";
            return;
          }

          emptyMsg.textContent = "";

          let total = 0;

          items.forEach((item) => {
            const tr = document.createElement("tr");

            tr.innerHTML = `
              <td>${item.name}</td>
              <td>${item.quantity}</td>
              <td>$${item.price.toFixed(2)}</td>
              <td>$${(item.price * item.quantity).toFixed(2)}</td>
            `;

            total += item.price * item.quantity;

            basketBody.appendChild(tr);
          });

          totalAmount.textContent = "$" + total.toFixed(2);
        };
      }



      function clearBasket() {
        if (!confirm("Clear entire basket?")) return;

        const tx = db.transaction("cart", "readwrite");
        const store = tx.objectStore("cart");

        store.clear().onsuccess = () => {
          emptyMsg.textContent = "Basket is empty.";
          basketBody.innerHTML = "";
          totalAmount.textContent = "$0.00";
          setStatusOk("Basket cleared.");
        };
      }

 

      function confirmOrder() {
   
        alert("Demo only: Order confirmed!");
      }



      function goBack() {
        window.location.href = "shop.html";
      }
    </script>
  </body>
</html>
