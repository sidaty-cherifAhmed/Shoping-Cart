<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Shop ‚Äì IndexedDB Basket Demo</title>

    <style>
   

      * {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        min-height: 100vh;

              display: flex;
        justify-content: center;
        align-items: center;

    
        background: radial-gradient(circle at top, #111827, #020617 60%);
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          sans-serif;
        color: #f9fafb;
      }

      .page-shell {
        width: 1150px;
        max-width: 96vw;
        background: #020617;
        border-radius: 22px;
        box-shadow: 0 26px 70px rgba(0, 0, 0, 0.9);
        border: 1px solid rgba(148, 163, 184, 0.4);
        padding: 24px 26px 26px;

        display: grid;
        grid-template-columns: 2fr 1fr; 
        gap: 20px;
      }

      .header {
        grid-column: 1 / -1;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 6px;
      }

      .header-title {
        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .header h1 {
        margin: 0;
        font-size: 1.9rem;
      }

      .header p {
        margin: 0;
        font-size: 0.95rem;
        color: #9ca3af;
      }

      .badge {
        background: rgba(37, 99, 235, 0.15);
        border-radius: 999px;
        padding: 6px 14px;
        font-size: 0.78rem;
        color: #bfdbfe;
        border: 1px solid rgba(59, 130, 246, 0.6);
      }

     

      .products-panel {
        padding-right: 6px;
        border-right: 1px solid rgba(55, 65, 81, 0.9);
        display: flex;
        flex-direction: column;
        gap: 12px;
      }

      .section-title {
        font-size: 0.95rem;
        font-weight: 600;
        margin-bottom: 4px;
      }

      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 12px;
      }

      .product-card {
        background: radial-gradient(circle at top, #111827, #020617 55%);
        border-radius: 14px;
        padding: 12px 12px 14px;
        border: 1px solid rgba(55, 65, 81, 0.9);

        display: flex;
        flex-direction: column;
        gap: 4px;
      }

      .product-name {
        font-weight: 600;
        font-size: 0.98rem;
      }

      .product-desc {
        font-size: 0.8rem;
        color: #9ca3af;
      }

      .product-footer {
        margin-top: 6px;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .product-price {
        font-weight: 700;
        color: #22c55e;
        font-size: 0.98rem;
      }



      button {
        padding: 7px 12px;
        border-radius: 999px;
        border: none;
        cursor: pointer;
        font-size: 0.85rem;
        font-weight: 600;
        color: #e5e7eb;
        background: #2563eb;

        transition: background 0.18s ease, transform 0.12s ease,
          box-shadow 0.18s ease;

        box-shadow: 0 3px 10px rgba(37, 99, 235, 0.45);
      }

      button:hover {
        background: #1d4ed8;
        transform: translateY(-1px);
        box-shadow: 0 5px 16px rgba(37, 99, 235, 0.7);
      }

      button:active {
        transform: translateY(0);
        box-shadow: 0 3px 8px rgba(37, 99, 235, 0.45);
      }

      .btn-secondary {
        background: #6b7280;
        box-shadow: 0 3px 10px rgba(75, 85, 99, 0.6);
      }
      .btn-secondary:hover {
        background: #4b5563;
      }

      .btn-danger {
        background: #dc2626;
        box-shadow: 0 3px 10px rgba(220, 38, 38, 0.6);
      }
      .btn-danger:hover {
        background: #b91c1c;
      }


      .cart-panel {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .cart-card {
        background: #030712;
        border-radius: 16px;
        padding: 14px 16px;
        border: 1px solid rgba(55, 65, 81, 0.9);

        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .cart-items {
        max-height: 260px;
        overflow-y: auto;
        padding-right: 4px;
      }

      .cart-empty {
        font-size: 0.82rem;
        color: #9ca3af;
      }

      .cart-item {
        display: grid;
        grid-template-columns: 1fr auto;
        gap: 4px 8px;
        padding: 8px 10px;
        border-radius: 10px;

        background: radial-gradient(
          circle at left,
          rgba(15, 23, 42, 0.9),
          #020617
        );
        border: 1px solid rgba(55, 65, 81, 0.9);

        margin-bottom: 6px;
        align-items: center;
      }

      .cart-item-main {
        display: flex;
        flex-direction: column;
        gap: 2px;
      }

      .cart-item-name {
        font-size: 0.9rem;
        font-weight: 600;
      }

      .cart-item-price {
        font-size: 0.8rem;
        color: #9ca3af;
      }

      .cart-item-controls {
        display: flex;
        align-items: center;
        gap: 6px;
        justify-self: end;
      }

      .qty-display {
        min-width: 26px;
        text-align: center;
        font-size: 0.9rem;
      }

      .small-btn {
        padding: 3px 8px;
        font-size: 0.8rem;
        border-radius: 999px;
      }

      .remove-link {
        color: #fca5a5;
        font-size: 0.75rem;
        cursor: pointer;
        text-decoration: underline;
        align-self: flex-start;
        margin-top: 2px;
      }

      .cart-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 4px;
        font-size: 0.9rem;
      }

      .total-label {
        color: #9ca3af;
      }

      .total-value {
        font-size: 1rem;
        font-weight: 700;
        color: #4ade80;
      }

      .cart-actions {
        display: flex;
        justify-content: space-between;
        gap: 8px;
        margin-top: 8px;
      }

      .cart-status {
        font-size: 0.78rem;
        color: #9ca3af;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .status-dot {
        width: 8px;
        height: 8px;
        border-radius: 50%;
      }

      .dot-ok {
        background: #22c55e; 
      }

      .dot-wait {
        background: #facc15; 
      }
    </style>
  </head>

  <body>
    <div class="page-shell">
 
      <div class="header">
        <div class="header-title">
          <h1>JavaScript Shop (IndexedDB)</h1>
          <p>
            Products stored in IndexedDB ‚Äì basket persists while tab is open.
          </p>
        </div>
        <div class="badge">IndexedDB ‚Ä¢ Products Store + Cart Store</div>
      </div>

      <div class="products-panel">
        <div class="section-title">üõç Products</div>
        <div id="productsGrid" class="products-grid">
          
        </div>
      </div>

      <div class="cart-panel">
        <div class="cart-card">
          <div class="section-title">üß∫ Basket</div>

          <div id="cartItems" class="cart-items">
            <div id="cartEmpty" class="cart-empty">Your basket is empty.</div>
          </div>

          <div class="cart-footer">
            <span class="total-label">Total:</span>
            <span id="cartTotal" class="total-value">$0.00</span>
          </div>

          <div class="cart-actions">
            <button class="btn-danger" onclick="clearCart()">
              üóë Clear Basket
            </button>
            <button onclick="goToCheckout()">Checkout ‚Üí</button>
          </div>

          <div class="cart-status">
            <div id="statusDot" class="status-dot dot-wait"></div>
            <span id="statusText">Opening database...</span>
          </div>
        </div>
      </div>
    </div>

    <script>
    
      let db = null;

      const productsGrid = document.getElementById("productsGrid");
      const cartItems = document.getElementById("cartItems");
      const cartEmpty = document.getElementById("cartEmpty");
      const cartTotal = document.getElementById("cartTotal");
      const statusDot = document.getElementById("statusDot");
      const statusText = document.getElementById("statusText");


      function setStatusOk(message) {
        statusDot.classList.remove("dot-wait"); 
        statusDot.classList.add("dot-ok"); 
        statusText.textContent = message; 
      }

      function setStatusWait(message) {
        statusDot.classList.remove("dot-ok"); 
        statusDot.classList.add("dot-wait"); 
        statusText.textContent = message;
      }

      setStatusWait("Opening database...");

      const openRequest = indexedDB.open("ShopDB", 1);

      openRequest.onupgradeneeded = function (event) {
        const dbInstance = event.target.result;

        dbInstance.createObjectStore("products", { keyPath: "id" });

        dbInstance.createObjectStore("cart", { keyPath: "id" });

        const seedProducts = [
          {
            id: 1,
            name: "JavaScript Basics Course",
            price: 49,
            description: "Perfect for beginners starting JS.",
          },
          {
            id: 2,
            name: "Advanced JS Patterns",
            price: 79,
            description: "Deep dive into patterns and architecture.",
          },
          {
            id: 3,
            name: "DOM Mastery Workshop",
            price: 39,
            description: "DOM, events, and interactive UIs.",
          },
          {
            id: 4,
            name: "Async & Promises Lab",
            price: 59,
            description: "Master async, promises, and async/await.",
          },
          {
            id: 5,
            name: "IndexedDB Hands-On",
            price: 29,
            description: "Offline storage & IndexedDB in practice.",
          },
          {
            id: 6,
            name: "Fullstack JS Bundle",
            price: 129,
            description: "Front-end + Node.js + APIs bundle.",
          },
        ];

        const tx = event.target.transaction; 
        const store = tx.objectStore("products"); 

    
        seedProducts.forEach((product) => {
          store.add(product);
        });
      };

      openRequest.onsuccess = function (event) {
        db = event.target.result;
        setStatusOk("Database opened.");

        loadProducts();//stop
        renderCart();
      };

      openRequest.onerror = function (event) {
        console.error("Error opening ShopDB:", event.target.error);
        setStatusWait("Error opening DB.");
      };

      function loadProducts() {
        productsGrid.innerHTML = "";

        const tx = db.transaction("products", "readonly");
        const store = tx.objectStore("products");

        const request = store.getAll();

        request.onsuccess = function () {
          const products = request.result;

          if (!products || products.length === 0) {
            productsGrid.innerHTML =
              "<p style='color:#9ca3af;font-size:0.9rem;'>No products found.</p>";
            return;
          }

          products.forEach((product) => {
            const card = document.createElement("div");
            card.className = "product-card";

            card.innerHTML = `
              <div class="product-name">${product.name}</div>
              <div class="product-desc">${product.description}</div>
              <div class="product-footer">
                <div class="product-price">$${product.price.toFixed(2)}</div>
                <button onclick="addToCart(${
                  product.id
                })">Add to Basket</button>
              </div>
            `;

            productsGrid.appendChild(card);
          });
        };

        request.onerror = function () {
          console.error("Error loading products.");
        };
      }

      function addToCart(productId) {
        setStatusWait("Updating basket...");//stop

        const tx = db.transaction(["products", "cart"], "readwrite");
        const productsStore = tx.objectStore("products");
        const cartStore = tx.objectStore("cart");

        const productRequest = productsStore.get(productId);

        productRequest.onsuccess = function () {
          const product = productRequest.result;

          if (!product) {
            console.error("Product not found:", productId);
            setStatusWait("Product not found.");
            return;
          }

          const cartItemRequest = cartStore.get(productId);

          cartItemRequest.onsuccess = function () {
            const existing = cartItemRequest.result;

            if (existing) {
              existing.quantity += 1;
              cartStore.put(existing);
            } else {
              cartStore.add({
                id: product.id,
                name: product.name,
                price: product.price,
                quantity: 1,
              });
            }
          };
        };

        tx.oncomplete = function () {
          renderCart();
          setStatusOk("Basket updated.");
        };

        tx.onerror = function () {
          console.error("Error adding to cart.");
          setStatusWait("Error updating basket.");
        };
      }

      function increaseQty(productId) {
        const tx = db.transaction("cart", "readwrite");
        const cartStore = tx.objectStore("cart");

        const req = cartStore.get(productId);

        req.onsuccess = function () {
          const item = req.result;
          if (!item) return;

          item.quantity += 1;
          cartStore.put(item);
        };

        tx.oncomplete = function () {
          renderCart(); 
        };
      }

      function decreaseQty(productId) {
        const tx = db.transaction("cart", "readwrite");
        const cartStore = tx.objectStore("cart");

        const req = cartStore.get(productId);

        req.onsuccess = function () {
          const item = req.result;
          if (!item) return;

          if (item.quantity <= 1) {
            cartStore.delete(productId);
          } else {
            item.quantity -= 1;
            cartStore.put(item);
          }
        };

        tx.oncomplete = function () {
          renderCart();
        };
      }

      function removeFromCart(productId) {
        const tx = db.transaction("cart", "readwrite");
        const cartStore = tx.objectStore("cart");

        cartStore.delete(productId);

        tx.oncomplete = function () {
          renderCart();
        };
      }

      function clearCart() {
        if (!confirm("Clear entire basket?")) return;

        const tx = db.transaction("cart", "readwrite");
        const cartStore = tx.objectStore("cart");

        cartStore.clear();

        tx.oncomplete = function () {
          renderCart();
          setStatusOk("Basket cleared.");
        };
      }

      function renderCart() {
        cartItems.innerHTML = ""; 

        const tx = db.transaction("cart", "readonly");
        const cartStore = tx.objectStore("cart");
        const req = cartStore.getAll();

        req.onsuccess = function () {
          const items = req.result;

      
          if (!items || items.length === 0) {
            cartEmpty.style.display = "block";
            cartEmpty.textContent = "Your basket is empty.";
            cartTotal.textContent = "$0.00";
            return;
          }

    
          cartEmpty.style.display = "none";

          let total = 0;

          items.forEach((item) => {
            const itemTotal = item.price * item.quantity;
            total += itemTotal;

            const row = document.createElement("div");
            row.className = "cart-item";

            row.innerHTML = `
              <div class="cart-item-main">
                <div class="cart-item-name">${item.name}</div>
                <div class="cart-item-price">
                  $${item.price.toFixed(2)} √ó ${
              item.quantity
            } = $${itemTotal.toFixed(2)}
                </div>
                <span class="remove-link" onclick="removeFromCart(${item.id})">
                  Remove
                </span>
              </div>

              <div class="cart-item-controls">
                <button class="small-btn" onclick="decreaseQty(${
                  item.id
                })">‚àí</button>
                <span class="qty-display">${item.quantity}</span>
                <button class="small-btn" onclick="increaseQty(${
                  item.id
                })">+</button>
              </div>
            `;

            cartItems.appendChild(row);
          });

          cartTotal.textContent = "$" + total.toFixed(2);
        };

        req.onerror = function () {
          console.error("Error reading cart.");
        };
      }

      function goToCheckout() {
        window.location.href = "checkout.html";
      }
    </script>
  </body>
</html>
